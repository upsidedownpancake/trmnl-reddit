name: Update TRMNL

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Reddit and Push to TRMNL
        run: |
          # Fetch Reddit JSON and extract images
          curl -s 'https://www.reddit.com/r/gonewild.json' | \
          jq '{images: [.data.children[].data | select(.url and (.url | contains("i.redd.it")) and (.url | test("\\.jpe?g$|\\.png$"))) | {url: .url, title: .title}]}' | \
          jq -c '{merge_variables: .}' | \
          curl -X POST "${{ secrets.TRMNL_WEBHOOK }}" \
            -H "Content-Type: application/json" \
            -d @-
