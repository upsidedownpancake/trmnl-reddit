# Try the 'old' subdomain - it often bypasses the strict 'guest' blocks on NSFW
RAW_JSON=$(curl -s -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
  'https://old.reddit.com/r/gonewild.json?limit=5')

# Check if we actually got data before sending to TRMNL
if [[ $(echo "$RAW_JSON" | jq '.data.children | length') -eq 0 ]]; then
  echo "Error: Reddit returned no posts. They might be blocking guest access for this sub."
  exit 1
fi

PAYLOAD=$(echo "$RAW_JSON" | jq -c '{
  merge_variables: {
    images: [
      .data.children[].data 
      | select(.url != null and (.url | test("i\\.redd\\.it.*\\.(jpe?g|png)$"))) 
      | {url: .url, title: .title}
    ]
  }
}')
